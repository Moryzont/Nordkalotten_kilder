<!DOCTYPE html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title | default: site.title }}</title>
  <!-- Possibly load Google Fonts or local fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Merriweather&family=Raleway:wght@700&display=swap"
    rel="stylesheet"
  >
  <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">
</head>
<body>
  <header class="site-header">
    <nav class="top-nav">
      <a href="{{ '/' | relative_url }}" class="site-brand">High North Sources</a>
      <ul class="nav-links">
        <li><a href="{{ '/table.html' | relative_url }}">Census and tax records</a></li>
        <li><a href="{{ '/court.html' | relative_url }}">Court Records</a></li>
        <li><a href="{{ '/regnskap.html' | relative_url }}">Accounts</a></li>
      </ul>
    </nav>
  </header>
  
  <main class="content">
    <!-- Here is where the page content is injected -->
    {{ content }}
  </main>

  <!-- Now place your scripts near the bottom of the same body -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.5/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.5/vfs_fonts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <script>
$(document).ready(function(){
  const csvFilePath = "{{ '/Sources_by_type/Manntall.csv' | relative_url }}";
  const columns = [
    { data: 'Census_type' },
    { data: 'Year' },
    { data: 'Geographic_area' },
    { data: 'Detail_level' },
    { data: 'State' },
    { data: 'Creator' },
    { data: 'dat_grov' },
    { data: 'Usefull_info' },
    { data: 'Reference' },
    { data: 'Pagenumber' },
    {
    data: 'Digitized_link',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger">
                  <i class="fas fa-frown"></i> No link
                </span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-primary">Link</a>`;
    }
  },
    { data: 'Transcribed' },
    { data: 'Tabulated' },
    {
    data: 'Transcription_link',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger">
                  <i class="fas fa-frown"></i> No link
                </span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-success">Transcription</a>`;
    }
  },
  {
    data: 'Table_link',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger">
                  <i class="fas fa-frown"></i> No link
                </span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-info">Table</a>`;
    }
  },
  {
    data: 'Archival_portal_link',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger">
                  <i class="fas fa-frown"></i> No link
                </span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-warning">Archive</a>`;
    }
  }
];

Papa.parse(csvFilePath, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const data = results.data;

      // Initialize DataTables
      const table = $('#manntall-table').DataTable({
        data: data,
        columns: columns,
        // Show a CSV download button, plus the usual filter, etc.
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'csvHtml5',
            text: 'Download CSV',
            className: 'btn btn-primary'
          }
        ],
        paging: false,
        ordering: true,
        searching: true,
        info: false,
        lengthChange: false,

        // initComplete: set up per-column searches for the second row
        initComplete: function() {
          const api = this.api();

          // For each column, bind the input in the second thead row
          // The second row is index(1)
          // each() to loop over all columns
          $('#manntall-table thead tr:eq(1) th').each(function(index) {
            // find the <input> inside this <th>
            $('input', this).on('keyup change', function() {
              if (api.column(index).search() !== this.value) {
                api.column(index).search(this.value).draw();
              }
            });
          });
        }
      });
    }
  });
});
  </script>
</body>
</html>