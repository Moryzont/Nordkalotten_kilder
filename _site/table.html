<!-- FILE: _layouts/wide.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Census and Tax records, until 1750</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Merriweather&family=Raleway:wght@700&display=swap"
    rel="stylesheet"
  >
  <link rel="stylesheet" href="/Nordkalotten_kilder/assets/css/custom.css">
  <!-- (Optional) If you need Font Awesome for icons: -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <header class="site-header">
    <nav class="top-nav">
      <a href="/Nordkalotten_kilder/" class="site-brand">High North Sources</a>
      <ul class="nav-links">
        <li><a href="/Nordkalotten_kilder/table.html">Census and tax records</a></li>
        <li><a href="/Nordkalotten_kilder/court.html">Court Records</a></li>
        <li><a href="/Nordkalotten_kilder/regnskap.html">Accounts</a></li>
      </ul>
    </nav>  </header>
  
  <main class="content-wide">
    <h1 id="interactive-table">Interactive Table</h1>

<p><a href="/Nordkalotten_kilder/"><strong>Back to Home</strong></a></p>

<p>Below is the interactive table loading data from <code class="language-plaintext highlighter-rouge">Sources_by_type/Manntall.csv</code>.</p>

<div id="top-scrollbar">
  <div id="top-scroll-content"></div>
</div>

<div id="table-container">
  <table id="manntall-table" class="table table-striped">
    <thead>
      <tr>
        <th>Census_type</th>
        <th>Year</th>
        <th>Geographic_area</th>
        <th>Detail_level</th>
        <th>State</th>
        <th>Creator</th>
        <th>dat_grov</th>
        <th>Usefull_info</th>
        <th>Reference</th>
        <th>Pagenumber</th>
        <th>Digitized_link</th>
        <th>Transcribed</th>
        <th>Tabulated</th>
        <th>Transcription_link</th>
        <th>Table_link</th>
        <th>Archival_portal_link</th>
      </tr>
      <tr>
        <th><input type="text" placeholder="Type" style="width:100%;" /></th>
        <th><input type="text" placeholder="Year" style="width:100%;" /></th>
        <th><input type="text" placeholder="Area" style="width:100%;" /></th>
        <th><input type="text" placeholder="Detail" style="width:100%;" /></th>
        <th><input type="text" placeholder="State" style="width:100%;" /></th>
        <th><input type="text" placeholder="Creator" style="width:100%;" /></th>
        <th><input type="text" placeholder="dat_grov" style="width:100%;" /></th>
        <th><input type="text" placeholder="Info" style="width:100%;" /></th>
        <th><input type="text" placeholder="Reference" style="width:100%;" /></th>
        <th><input type="text" placeholder="Page" style="width:100%;" /></th>
        <th><input type="text" placeholder="DigLink" style="width:100%;" /></th>
        <th><input type="text" placeholder="Transcribed" style="width:100%;" /></th>
        <th><input type="text" placeholder="Tabulated" style="width:100%;" /></th>
        <th><input type="text" placeholder="TransLink" style="width:100%;" /></th>
        <th><input type="text" placeholder="TableLink" style="width:100%;" /></th>
        <th><input type="text" placeholder="Portal" style="width:100%;" /></th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
// 1) define columns, each with a fixed width summing > 1200
const columns = [
  { data: 'Census_type', width: '150px' },
  { data: 'Year', width: '80px' },
  { data: 'Geographic_area', width: '150px' },
  { data: 'Detail_level', width: '120px' },
  { data: 'State', width: '100px' },
  { data: 'Creator', width: '120px' },
  { data: 'dat_grov', width: '100px' },
  { data: 'Usefull_info', width: '120px' },
  { data: 'Reference', width: '120px' },
  { data: 'Pagenumber', width: '80px' },
  {
    data: 'Digitized_link', width: '140px',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger"><i class="fas fa-frown"></i> No link</span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-primary">Link</a>`;
    }
  },
  { data: 'Transcribed', width: '80px' },
  { data: 'Tabulated', width: '80px' },
  {
    data: 'Transcription_link', width: '140px',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger"><i class="fas fa-frown"></i> No link</span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-success">Transcription</a>`;
    }
  },
  {
    data: 'Table_link', width: '140px',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger"><i class="fas fa-frown"></i> No link</span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-info">Table</a>`;
    }
  },
  {
    data: 'Archival_portal_link', width: '140px',
    render: function(url) {
      if (!url || url.trim().toLowerCase() === 'x') {
        return `<span class="text-danger"><i class="fas fa-frown"></i> No link</span>`;
      }
      return `<a href="${url}" target="_blank" class="btn btn-sm btn-warning">Archive</a>`;
    }
  }
];

document.addEventListener('DOMContentLoaded', function() {
  console.log("Papa parse beginning...");
  Papa.parse("/Nordkalotten_kilder/Sources_by_type/Manntall.csv", {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      console.log("Papa parse complete. Found rows:", results.data.length);
      console.log("Sample row:", results.data[0]); // debug check

      // 2) Initialize DataTables
      const table = $('#manntall-table').DataTable({
        data: results.data,
        columns: columns,
        scrollX: true,
        autoWidth: false,
        dom: 'Bfrtip',
        buttons: [
          {
            extend: 'csvHtml5',
            text: 'Download CSV',
            className: 'btn btn-primary'
          }
        ],
        paging: false,
        ordering: true,
        searching: true,
        info: false,
        lengthChange: false,
        initComplete: function() {
          const api = this.api();
          $('#manntall-table thead tr:eq(1) th').each(function(i) {
            $('input', this).on('keyup change', function() {
              if (api.column(i).search() !== this.value) {
                api.column(i).search(this.value).draw();
              }
            });
          });
          console.log("DataTables initComplete. Table row count:", api.rows().count());
        }
      });
    }
  });
});

// top scrollbar sync
document.addEventListener('DOMContentLoaded', function() {
  const topScroll = document.getElementById('top-scrollbar');
  const topScrollContent = document.getElementById('top-scroll-content');
  const tableContainer = document.getElementById('table-container');
  const manntallTable = document.getElementById('manntall-table');

  function updateScrollWidths() {
    const w = manntallTable.scrollWidth;
    console.log("table scrollWidth = ", w);
    topScrollContent.style.width = w + 'px';
  }

  // sync events
  topScroll.addEventListener('scroll', () => {
    tableContainer.scrollLeft = topScroll.scrollLeft;
  });
  tableContainer.addEventListener('scroll', () => {
    topScroll.scrollLeft = tableContainer.scrollLeft;
  });

  // wait a moment for DataTables to finalize layout
  setTimeout(updateScrollWidths, 1500);
  window.addEventListener('resize', updateScrollWidths);
});
</script>


  </main>

  <!-- Scripts: jQuery, Bootstrap, DataTables, Buttons, Papa Parse, etc. -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- DataTables core + adapter -->
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

  <!-- DataTables Buttons -->
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.5/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.5/vfs_fonts.js"></script>
  
  <!-- Papa Parse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <!-- NO inline code here referencing Papa, DataTables, etc. 
       That goes in the page file (table.md). -->
</body>
</html>
